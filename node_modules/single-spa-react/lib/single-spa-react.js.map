{"version":3,"sources":["../src/single-spa-react.js"],"names":[],"mappings":"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","file":"single-spa-react.js","sourcesContent":["/* We don't import parcel.component.js from this file intentionally. See comment\n * in that file for why\n */\n\n// React context that gives any react component the single-spa props\nexport let SingleSpaContext = null\n\nconst defaultOpts = {\n  // required opts\n  React: null,\n  ReactDOM: null,\n  rootComponent: null,\n  loadRootComponent: null,\n  domElementGetter: null,\n  suppressComponentDidCatchWarning: false,\n\n  // optional opts\n  domElementGetter: null, // only can be omitted if provided as a custom prop\n  parcelCanUpdate: true, // by default, allow parcels created with single-spa-react to be updated\n}\n\nexport default function singleSpaReact(userOpts) {\n  if (typeof userOpts !== 'object') {\n    throw new Error(`single-spa-react requires a configuration object`);\n  }\n\n  const opts = {\n    ...defaultOpts,\n    ...userOpts,\n  };\n\n  if (!opts.React) {\n    throw new Error(`single-spa-react must be passed opts.React`);\n  }\n\n  if (!opts.ReactDOM) {\n    throw new Error(`single-spa-react must be passed opts.ReactDOM`);\n  }\n\n  if (!opts.rootComponent && !opts.loadRootComponent) {\n    throw new Error(`single-spa-react must be passed opts.rootComponent or opts.loadRootComponent`);\n  }\n\n  if (!SingleSpaContext && opts.React.createContext) {\n    SingleSpaContext = opts.React.createContext()\n  }\n\n  const lifecycles = {\n    bootstrap: bootstrap.bind(null, opts),\n    mount: mount.bind(null, opts),\n    unmount: unmount.bind(null, opts),\n  };\n\n  if (opts.parcelCanUpdate) {\n    lifecycles.update = update.bind(null, opts)\n  }\n\n  return lifecycles\n}\n\nfunction bootstrap(opts, props) {\n  if (opts.rootComponent) {\n    // This is a class or stateless function component\n    return Promise.resolve()\n  } else {\n    // They passed a promise that resolves with the react component. Wait for it to resolve before mounting\n    return opts\n      .loadRootComponent()\n      .then(resolvedComponent => {\n        opts.rootComponent = resolvedComponent\n      })\n  }\n}\n\nfunction mount(opts, props) {\n  return new Promise((resolve, reject) => {\n\n    if (!opts.rootComponent.prototype.componentDidCatch && !opts.suppressComponentDidCatchWarning && atLeastReact16(opts.React)) {\n      console.warn(`single-spa-react: ${props.name || props.appName || props.childAppName}'s rootComponent should implement componentDidCatch to avoid accidentally unmounting the entire single-spa application.`);\n    }\n\n    const domElementGetter = chooseDomElementGetter(opts, props)\n\n    if (!domElementGetter) {\n      throw new Error(`Cannot mount react application '${props.appName || props.name}' without a domElementGetter provided in either opts or props`)\n    }\n\n    const whenFinished = function() {\n      resolve(this);\n    };\n\n\n    const rootComponentElement = opts.React.createElement(opts.rootComponent, props)\n    const elementToRender = SingleSpaContext ? opts.React.createElement(SingleSpaContext.Provider, {value: props}, rootComponentElement) : rootComponentElement\n    const domElement = getRootDomEl(domElementGetter)\n    const renderedComponent = opts.ReactDOM.render(elementToRender, domElement, whenFinished)\n    opts.domElement = domElement\n  })\n}\n\nfunction unmount(opts, props) {\n  return Promise\n    .resolve()\n    .then(() => {\n      opts.ReactDOM.unmountComponentAtNode(opts.domElement);\n    })\n}\n\nfunction update(opts, props) {\n  return new Promise((resolve, reject) => {\n    const whenFinished = function() {\n      resolve(this);\n    };\n\n    const rootComponentElement = opts.React.createElement(opts.rootComponent, props)\n    const elementToRender = SingleSpaContext ? opts.React.createElement(SingleSpaContext.Provider, {value: props}, rootComponentElement) : rootComponentElement\n    const renderedComponent = opts.ReactDOM.render(elementToRender, opts.domElement, whenFinished)\n  })\n}\n\nfunction getRootDomEl(domElementGetter) {\n  const el = domElementGetter();\n  if (!el) {\n    throw new Error(`single-spa-react: domElementGetter function did not return a valid dom element`);\n  }\n\n  return el;\n}\n\nfunction atLeastReact16(React) {\n  if (React && typeof React.version === 'string' && React.version.indexOf('.') >= 0) {\n    const majorVersionString = React.version.slice(0, React.version.indexOf('.'));\n    try {\n      return Number(majorVersionString) >= 16;\n    } catch(err) {\n      return false;\n    }\n  } else {\n    return false;\n  }\n}\n\nfunction chooseDomElementGetter(opts, props) {\n  props = props && props.customProps ? props.customProps : props\n  if (props.domElement) {\n    return () => props.domElement\n  } else if (props.domElementGetter) {\n    return props.domElementGetter\n  } else {\n    return opts.domElementGetter\n  }\n}\n"]}